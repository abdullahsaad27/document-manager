import{_ as S,r as x,j as e,R as P}from"./index-UgHTj-EG.js";import{i as T,b as U}from"./database-CGTBBJr-.js";const j=()=>typeof window<"u"&&typeof window.__TAURI__<"u",p=async(d,n)=>{if(j())try{const{invoke:s}=await S(async()=>{const{invoke:c}=await import("./tauri-sAj06WXf.js");return{invoke:c}},[],import.meta.url),r=Array.from(n);await s("save_file",{fileName:d,fileBuffer:r})}catch(s){console.error("Failed to save file on desktop:",s),alert(`Error saving file: ${s}`)}else{const s=new Blob([n]),r=document.createElement("a");r.href=URL.createObjectURL(s),r.download=d,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href)}},O=Object.freeze(Object.defineProperty({__proto__:null,isDesktop:j,saveFile:p},Symbol.toStringTag,{value:"Module"})),$=({title:d,file:n,onReset:s,nextSteps:r,onNextStep:c,children:u,canSaveToLibrary:v,structuredContent:o,fileName:i,fileType:w,documentType:y,sourceFileName:k})=>{const[b,L]=x.useState(!1),[m,_]=x.useState(""),[B,g]=x.useState(""),l=x.useMemo(()=>o?o.map(t=>t.content).join(`

`):"",[o]),C=async()=>{if(n)try{const t=await n.arrayBuffer(),a=new Uint8Array(t);await p(n.name,a)}catch(t){console.error("Download failed:",t),alert("Could not download the file.")}},D=async()=>{if(!(!o||!i||!w))try{await T(),await U({name:i,fileType:w,content:o,createdAt:new Date,documentType:y,sourceFileName:k}),L(!0)}catch{_("فشل حفظ المستند في المكتبة.")}},E=()=>{l&&navigator.clipboard.writeText(l).then(()=>{g("تم النسخ!"),setTimeout(()=>g(""),2e3)}).catch(t=>{g("فشل النسخ"),console.error("فشل النسخ: ",t)})},H=async()=>{if(!l||!i)return;const t=new Blob([l],{type:"text/plain;charset=utf-8"}),a=new Uint8Array(await t.arrayBuffer());await p(`${i.split(".")[0]}.txt`,a)},M=async()=>{if(!o||o.length===0||!i)return;const t=window.docx;if(!t||!t.Document||!t.Paragraph||!t.Packer){alert("مكتبة تصدير Word غير متاحة أو لم يتم تحميلها بالكامل. يرجى التحقق من اتصالك بالإنترنت وتحديث الصفحة.");return}try{const a=o.map(h=>{if(h.type==="heading"){const f=Math.max(1,Math.min(6,h.level||2));return new t.Paragraph({text:h.content,heading:t.HeadingLevel[`HEADING_${f}`]||`Heading${f}`,bidirectional:!0})}return new t.Paragraph({text:h.content,bidirectional:!0})}),A=new t.Document({sections:[{children:a}]}),R=await t.Packer.toBlob(A),N=new Uint8Array(await R.arrayBuffer());await p(`${i.split(".")[0]}.docx`,N)}catch(a){alert(`حدث خطأ أثناء التصدير: ${a.message}`)}};return e.jsxs("div",{className:"max-w-4xl mx-auto bg-white dark:bg-slate-800 p-8 rounded-xl shadow-lg text-center",children:[e.jsx("div",{className:"mx-auto text-green-500 mb-4 h-16 w-16 flex items-center justify-center rounded-full bg-green-100 dark:bg-green-900/50",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100 mb-4",children:d}),u&&e.jsx("div",{className:"my-6 bg-slate-50 dark:bg-slate-800/50 p-4 rounded-lg border dark:border-slate-700",children:u}),e.jsxs("div",{className:"flex flex-wrap justify-center items-center gap-4 my-6",children:[n&&e.jsxs("button",{onClick:C,className:"bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),e.jsx("span",{children:"تحميل النتيجة"})]}),v&&e.jsxs("div",{role:"status",children:[e.jsxs("button",{onClick:D,disabled:b,className:"bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition-colors disabled:bg-slate-400 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:e.jsx("path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"})}),e.jsx("span",{children:b?"تم الحفظ!":"حفظ إلى المكتبة"})]}),m&&e.jsx("p",{role:"alert",className:"text-red-500 text-sm mt-1",children:m})]}),o&&l&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:E,className:"bg-teal-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-teal-700 transition-colors flex items-center gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),e.jsx("span",{children:B||"نسخ النص"})]}),e.jsxs("button",{onClick:H,className:"bg-slate-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-slate-600 transition-colors flex items-center gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("line",{x1:"10",y1:"9",x2:"8",y2:"9"})]}),e.jsx("span",{children:"تصدير كـ TXT"})]}),e.jsxs("button",{onClick:M,className:"bg-sky-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-sky-700 transition-colors flex items-center gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("path",{d:"M12 18v-7.5a2.5 2.5 0 0 1 5 0V18"}),e.jsx("path",{d:"M12 18H7.5a2.5 2.5 0 1 1 0-5H12"})]}),e.jsx("span",{children:"تصدير كـ DOCX"})]})]}),e.jsx("button",{onClick:s,className:"bg-slate-200 text-slate-800 dark:bg-slate-600 dark:text-slate-100 font-bold py-3 px-6 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-500 transition-colors",children:"البدء من جديد"})]}),r&&c&&n&&r.length>0&&e.jsxs("div",{className:"mt-8 border-t dark:border-slate-700 pt-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-700 dark:text-slate-200 mb-4",children:"الخطوات التالية المقترحة:"}),e.jsx("div",{className:"flex flex-wrap justify-center gap-3",children:r.map(t=>e.jsxs("button",{onClick:()=>c(t,n),className:"bg-slate-100 text-slate-700 dark:bg-slate-700 dark:text-slate-200 font-semibold py-2 px-4 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors flex items-center gap-2",children:[P.cloneElement(t.icon,{style:{width:18,height:18},"aria-hidden":!0}),t.title]},t.id))})]})]})};export{$ as R,O as p};
