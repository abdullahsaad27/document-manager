import{r as l,u as C,j as e,a as L,W as S}from"./index-BTUQfSWa.js";import{S as R}from"./ServiceCard-5csCeWT8.js";import{P as M,W as _}from"./PdfToWord-LOGjOrcs.js";import{a as B,G as H}from"./settingsService-p0j8CqeW.js";import{F as K}from"./FileUpload-CeNdxQgG.js";import{A as P}from"./aiService-0OA8UE0R.js";import"https://cdn.jsdelivr.net/npm/pdfjs-dist@4.4.168/build/pdf.min.mjs";import"./ResultView-BWtcuH1S.js";import"./database-CGTBBJr-.js";var D={};const $=()=>{const[c,i]=l.useState(null),[x,d]=l.useState(""),[u,h]=l.useState(""),[w,m]=l.useState(!1),[f,t]=l.useState(""),[a,o]=l.useState([]),[g,N]=l.useState(""),[b,y]=l.useState(!1),p=l.useRef(null),{setInterruptedTask:T}=C();l.useEffect(()=>{p.current&&(p.current.scrollTop=p.current.scrollHeight)},[a]);const W=async r=>{if(r.length>0){const s=r[0];if(!s.type.includes("wordprocessingml.document")){t("الرجاء اختيار ملف Word (DOCX) فقط.");return}i(s),m(!0),t(""),o([]);try{const n=await s.arrayBuffer();if(!window.mammoth)throw new Error("مكتبة Mammoth غير متوفرة.");const v=await mammoth.convertToHtml({arrayBuffer:n});d(v.value);const k=await mammoth.extractRawText({arrayBuffer:n});h(k.value),o([{role:"assistant",content:`مرحباً! لقد قمت بتحليل "${s.name}". يمكنك الآن سؤالي عن أي شيء يخص محتوى الملف، أو طلب تلخيصه، أو إعادة صياغة أجزاء منه.`}])}catch(n){t("فشل في قراءة ملف Word. تأكد من أنه غير تالف."),console.error(n)}finally{m(!1)}}},j=async()=>{if(!g.trim()||!u)return;const r=g;N(""),o(s=>[...s,{role:"user",content:r}]),y(!0);try{const s=B(),n=s.googleApiKey||D.API_KEY;if(!n)throw new Error("API Key missing");const v=new H({apiKey:n}),k=s.model||"gemini-3-flash-preview",A=`
            Context from Word Document:
            """
            ${u.substring(0,3e4)} 
            """
            
            User Question: ${r}
            
            Please answer the user's question based on the document context above. 
            Respond in Arabic unless the user asks otherwise. 
            If the user asks for rewriting or translation, perform the task directly.
            `,E=(await v.models.generateContent({model:k,contents:A})).text||"عذراً، لم أتمكن من الرد.";o(F=>[...F,{role:"assistant",content:E}])}catch(s){s.message?.includes("429")||s instanceof P?(T({serviceId:"word-assistant",resume:j,context:{}}),o(n=>[...n,{role:"assistant",content:"تم الوصول إلى حد الاستخدام. يرجى المحاولة لاحقاً."}])):o(n=>[...n,{role:"assistant",content:"حدث خطأ أثناء المعالجة."}]),console.error(s)}finally{y(!1)}},I=()=>{i(null),d(""),h(""),o([]),t("")};return e.jsx("div",{className:"max-w-7xl mx-auto h-[85vh] flex flex-col",children:c?e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 h-full",children:[e.jsxs("div",{className:"lg:w-3/5 bg-white dark:bg-slate-800 rounded-xl shadow-lg flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-900",children:[e.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-100 truncate max-w-md",title:c.name,children:c.name}),e.jsx("button",{onClick:I,className:"text-sm text-red-500 hover:text-red-700",children:"إغلاق الملف"})]}),e.jsx("div",{className:"flex-grow overflow-y-auto p-8 bg-white text-slate-900 document-preview",children:e.jsx("div",{className:"prose max-w-none",dangerouslySetInnerHTML:{__html:x},style:{direction:"rtl",textAlign:"right"}})})]}),e.jsxs("div",{className:"lg:w-2/5 bg-white dark:bg-slate-800 rounded-xl shadow-lg flex flex-col border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"p-4 border-b dark:border-slate-700 bg-slate-50 dark:bg-slate-900",children:e.jsxs("h3",{className:"font-bold text-slate-800 dark:text-slate-100 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-blue-500",children:e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})}),"المساعد الذكي"]})}),e.jsxs("div",{className:"flex-grow overflow-y-auto p-4 space-y-4 bg-slate-50 dark:bg-slate-800/50",ref:p,children:[a.map((r,s)=>e.jsx("div",{className:`flex ${r.role==="user"?"justify-start":"justify-end"}`,children:e.jsx("div",{className:`max-w-[85%] p-3 rounded-lg ${r.role==="user"?"bg-blue-600 text-white rounded-tr-none":"bg-white dark:bg-slate-700 border dark:border-slate-600 text-slate-800 dark:text-slate-100 rounded-tl-none shadow-sm"}`,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap leading-relaxed",children:r.content})})},s)),b&&e.jsx("div",{className:"flex justify-end",children:e.jsx("div",{className:"bg-white dark:bg-slate-700 p-3 rounded-lg rounded-tl-none shadow-sm border dark:border-slate-600",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce"}),e.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-75"}),e.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-150"})]})})})]}),e.jsx("div",{className:"p-4 bg-white dark:bg-slate-800 border-t dark:border-slate-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:g,onChange:r=>N(r.target.value),onKeyDown:r=>r.key==="Enter"&&!r.shiftKey&&j(),placeholder:"اطلب تلخيصاً، ترجمة، أو استفسر عن المحتوى...",className:"flex-grow p-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-slate-50 dark:bg-slate-700 dark:text-white",disabled:b}),e.jsx("button",{onClick:j,disabled:b||!g.trim(),className:"bg-blue-600 text-white p-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"transform scale-x-[-1]",children:[e.jsx("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),e.jsx("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]})})]})})]})]}):e.jsx("div",{className:"flex-grow flex items-center justify-center bg-white dark:bg-slate-800 p-8 rounded-xl shadow-lg",children:e.jsxs("div",{className:"w-full max-w-2xl flex flex-col items-center",children:[e.jsx(K,{onFileSelect:W,acceptedFileTypes:".docx",promptText:"اسحب وأفلت ملف Word (DOCX) هنا",promptSubText:"للدردشة، التلخيص، والتحليل الذكي"}),w&&e.jsx("div",{className:"mt-6",children:e.jsx(L,{})}),f&&e.jsx("p",{className:"mt-4 text-red-500 bg-red-100 dark:bg-red-900/50 p-3 rounded",children:f})]})})})},Z=c=>{const[i,x]=l.useState(null),{stagedFile:d,setStagedFile:u}=C();l.useEffect(()=>{if(d?.context?.nextServiceId){const t=S.find(a=>a.id===d.context.nextServiceId);t&&x(t)}},[d]);const h=t=>{x(t)},w=()=>{x(null),u(null)},m=t=>{S.find(a=>a.id===t.id)?u(a=>{if(!a)return null;const o=new File([a],a.name,{type:a.type,lastModified:a.lastModified});return Object.assign(o,{context:{nextServiceId:t.id}})}):c.onSelectService(t)};if(!i)return e.jsxs("div",{children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-slate-800 dark:text-slate-100 mb-4",children:"أدوات Word"}),e.jsx("p",{className:"text-lg text-slate-600 dark:text-slate-300 max-w-3xl mx-auto",children:"حرر، حول، ودردش مع مستنداتك النصية باستخدام أحدث تقنيات الذكاء الاصطناعي."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 items-stretch max-w-5xl mx-auto",children:S.map(t=>e.jsx(R,{service:t,onClick:h},t.id))})]});const f=()=>{switch(i.id){case"word-to-pdf":return e.jsx(_,{onSelectService:m});case"pdf-to-word":return e.jsx(M,{onSelectService:m});case"word-assistant":return e.jsx($,{});default:return e.jsx("p",{children:"الأداة غير موجودة."})}};return e.jsxs("div",{children:[e.jsxs("button",{onClick:w,className:"mb-6 flex items-center gap-2 text-blue-600 hover:text-blue-800 transition-colors font-semibold",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"transform scale-x-[-1]","aria-hidden":"true",children:[e.jsx("path",{d:"M5 12h14"}),e.jsx("path",{d:"m12 5 7 7-7 7"})]}),e.jsx("span",{children:"العودة إلى أدوات Word"})]}),e.jsx("h2",{className:"text-3xl font-bold mb-8 text-center text-slate-800 dark:text-slate-100",children:i.title}),f()]})};export{Z as default};
