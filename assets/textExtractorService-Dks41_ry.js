const m=async(d,a)=>{const i=await d.arrayBuffer(),c=d.type;try{let r="";if(c==="application/pdf"){const e=window.PDFLib,s=window.pdfjsLib;if(!e)throw new Error("مكتبة PDFLib لم يتم تحميلها. يرجى التحقق من الاتصال وتحديث الصفحة.");if(!s)throw new Error("مكتبة PDF.js لم يتم تحميلها. يرجى التحقق من الاتصال وتحديث الصفحة.");a("جاري إصلاح بنية ملف PDF...");const{PDFDocument:w}=e;let l;try{const t=await w.load(i,{ignoreEncryption:!0}),n=await w.create();(await n.copyPages(t,t.getPageIndices())).forEach(o=>n.addPage(o));try{const o=n.getForm();o.getFields().length>0&&o.flatten()}catch{}l=await n.save()}catch(t){console.error("PDF repair failed, proceeding with original file.",t),l=i}a("جاري قراءة ملف PDF...");const f=await s.getDocument({data:l,verbosity:1}).promise,p=f.numPages;for(let t=1;t<=p;t++){a(`جاري قراءة الصفحة ${t} من ${p}...`);const g=await(await f.getPage(t)).getTextContent();r+=g.items.map(o=>o.str).join(" ")+`
`}}else if(c==="application/vnd.openxmlformats-officedocument.wordprocessingml.document"){const e=window.mammoth;if(!e)throw new Error("مكتبة Mammoth لم يتم تحميلها.");a("جاري استخراج النص من مستند Word..."),r=(await e.extractRawText({arrayBuffer:i})).value}else if(c==="text/plain")a("جاري قراءة الملف النصي..."),r=new TextDecoder().decode(i);else throw new Error("Unsupported file type for text extraction.");return r}catch(r){console.error("Text extraction failed:",r);const e=r.message||"An unknown error occurred during text extraction.";throw e.includes("Password")||e.includes("encrypted")?new Error("فشل استخراج النص. قد يكون الملف محميًا بكلمة مرور."):new Error(`فشل استخراج النص: ${e}`)}};export{m as e};
