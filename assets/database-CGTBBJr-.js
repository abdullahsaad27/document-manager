const l="DocumentExpertDB";const c="library",a="cacheStore";let i;const S=()=>new Promise((t,r)=>{if(i)return t(!0);const o=indexedDB.open(l,2);o.onerror=()=>{console.error("Database error:",o.error),r("Error opening database")},o.onsuccess=s=>{i=s.target.result,t(!0)},o.onupgradeneeded=s=>{const n=s.target.result;n.objectStoreNames.contains(c)||n.createObjectStore(c,{keyPath:"id",autoIncrement:!0}),n.objectStoreNames.contains(a)||n.createObjectStore(a,{keyPath:"id"})}}),b=t=>new Promise((r,o)=>{const e=i.transaction(c,"readwrite").objectStore(c).add(t);e.onsuccess=()=>{r(e.result)},e.onerror=()=>{console.error("Error saving document:",e.error),o("Could not save document.")}}),E=()=>new Promise((t,r)=>{const n=i.transaction(c,"readonly").objectStore(c).getAll();n.onsuccess=()=>{const e=n.result.sort((u,d)=>d.createdAt.getTime()-u.createdAt.getTime());t(e)},n.onerror=()=>{console.error("Error fetching documents:",n.error),r("Could not fetch documents.")}}),g=t=>new Promise((r,o)=>{const e=i.transaction(c,"readwrite").objectStore(c).delete(t);e.onsuccess=()=>{r()},e.onerror=()=>{console.error("Error deleting document:",e.error),o("Could not delete document.")}});const C=(t,r)=>new Promise((o,s)=>{const u=i.transaction(a,"readwrite").objectStore(a).put({id:t,data:r,timestamp:Date.now()});u.onsuccess=()=>o(),u.onerror=d=>{console.error("Error saving cache:",u.error),s("Could not save cache.")}}),m=t=>new Promise((r,o)=>{const e=i.transaction(a,"readwrite").objectStore(a).delete(t);e.onsuccess=()=>r(),e.onerror=()=>o("Could not delete cache item.")}),h=t=>new Promise((r,o)=>{const e=i.transaction(a,"readonly").objectStore(a).get(t);e.onsuccess=()=>{e.result?Date.now()-e.result.timestamp>864e5?m(t).finally(()=>r(null)):r(e.result.data):r(null)},e.onerror=()=>o("Could not fetch cache.")});export{E as a,b,g as d,h as g,S as i,C as s};
