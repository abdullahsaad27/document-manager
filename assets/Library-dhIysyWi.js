import{r,j as t,a as S}from"./index-C3edZBvR.js";import{i as E,a as F,d as O}from"./database-CGTBBJr-.js";import{C as R}from"./ConfirmationModal-DvLumpuQ.js";import"https://cdn.jsdelivr.net/npm/pdfjs-dist@4.4.168/build/pdf.min.mjs";const B={"application/pdf":"PDF","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"DOCX","application/vnd.openxmlformats-officedocument.presentationml.presentation":"PPTX","text/plain":"TXT","image/png":"PNG","image/jpeg":"JPG","image/webp":"WEBP"},w=o=>o.documentType==="summary"?"ملخص":o.documentType==="analysis"?"تحليل":B[o.fileType]||o.fileType.split("/").pop()?.toUpperCase()||"أصلي",A=({onViewDocument:o})=>{const[n,g]=r.useState([]),[v,f]=r.useState(!0),[b,m]=r.useState(""),[i,N]=r.useState(""),[l,D]=r.useState("الكل"),[C,x]=r.useState(!1),[p,h]=r.useState(null),y=r.useCallback(async()=>{try{f(!0),await E();const e=await F();g(e)}catch{m("فشل تحميل المكتبة. يرجى تحديث الصفحة.")}finally{f(!1)}},[]);r.useEffect(()=>{y()},[y]);const T=e=>{h(e),x(!0)},L=async()=>{if(p!==null)try{await O(p),g(e=>e.filter(s=>s.id!==p))}catch{m("فشل حذف المستند.")}finally{x(!1),h(null)}},M=()=>{x(!1),h(null)},P=e=>{const s=window.docx;if(!s||!s.Document||!s.Paragraph||!s.Packer){m("مكتبة تصدير Word غير متاحة أو لم يتم تحميلها بالكامل. يرجى التحقق من اتصالك بالإنترنت وتحديث الصفحة.");return}try{const u=e.content.map(a=>{if(a.type==="heading"){const c=Math.max(1,Math.min(6,a.level||2));return new s.Paragraph({text:a.content,heading:s.HeadingLevel[`HEADING_${c}`]||`Heading${c}`,bidirectional:!0})}return new s.Paragraph({text:a.content,bidirectional:!0})}),j=new s.Document({sections:[{children:u}]});s.Packer.toBlob(j).then(a=>{const c=URL.createObjectURL(a),d=document.createElement("a");d.href=c,d.download=`${e.name.split(".")[0]}.docx`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(c)})}catch(u){m(`حدث خطأ أثناء التصدير: ${u.message}`)}},$=r.useMemo(()=>{const e={الكل:n.length,ملخص:n.filter(s=>s.documentType==="summary").length,تحليل:n.filter(s=>s.documentType==="analysis").length};return Object.entries(e).filter(([,s])=>s>0)},[n]),k=n.filter(e=>{if(w(e),l!=="الكل"&&(l==="ملخص"&&e.documentType!=="summary"||l==="تحليل"&&e.documentType!=="analysis"))return!1;if(!i.trim())return!0;const s=i.toLowerCase();return!!(e.name.toLowerCase().includes(s)||e.sourceFileName&&e.sourceFileName.toLowerCase().includes(s)||e.content.some(a=>a.content.toLowerCase().includes(s)))});return v?t.jsx("div",{className:"flex justify-center items-center p-8",children:t.jsx(S,{})}):t.jsxs("div",{className:"max-w-4xl mx-auto bg-white dark:bg-slate-800 p-8 rounded-xl shadow-lg",children:[t.jsx("div",{className:"flex justify-between items-center mb-4 border-b dark:border-slate-700 pb-4",children:t.jsx("h2",{className:"text-2xl font-bold text-slate-700 dark:text-slate-100",children:"مستنداتك المحفوظة"})}),t.jsx("div",{className:"mb-6",children:t.jsxs("div",{className:"relative",children:[t.jsx("span",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none","aria-hidden":"true",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-slate-400",children:[t.jsx("circle",{cx:"11",cy:"11",r:"8"}),t.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})}),t.jsx("input",{type:"search",value:i,onChange:e=>N(e.target.value),placeholder:"ابحث بالاسم أو المحتوى...",className:"w-full p-3 pr-10 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-slate-700","aria-label":"ابحث في المكتبة"})]})}),n.length>0&&t.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-6 border-t dark:border-slate-700 pt-4",children:[t.jsx("span",{className:"font-semibold text-slate-600 dark:text-slate-300",children:"تصفية حسب النوع:"}),$.map(([e,s])=>t.jsxs("button",{onClick:()=>D(e),className:`px-3 py-1.5 rounded-full text-sm font-semibold transition-colors flex items-center gap-1.5 ${l===e?"bg-blue-600 text-white shadow":"bg-slate-200 text-slate-700 dark:bg-slate-700 dark:text-slate-200 hover:bg-slate-300 dark:hover:bg-slate-600"}`,children:[e,t.jsx("span",{className:`text-xs rounded-full px-1.5 py-0.5 ${l===e?"bg-white/20":"bg-slate-300 dark:bg-slate-600"}`,children:s})]},e))]}),b&&t.jsx("p",{role:"alert",className:"mb-4 text-red-500 bg-red-100 dark:bg-red-900/50 dark:text-red-300 p-3 rounded-md w-full text-center",children:b}),t.jsx("div",{role:"status",children:n.length===0?t.jsx("p",{className:"text-center text-slate-500 dark:text-slate-400 py-8",children:"مكتبتك فارغة. قم بتحليل مستند جديد واحفظه هنا!"}):k.length===0?t.jsx("p",{className:"text-center text-slate-500 dark:text-slate-400 py-8",children:i.trim()?`لم يتم العثور على مستندات تطابق بحثك "${i}" ضمن فلتر "${l}".`:`لا توجد مستندات من نوع "${l}".`}):t.jsx("ul",{className:"space-y-4",children:k.map(e=>t.jsxs("li",{className:"p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg shadow-sm flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 transition-all hover:shadow-md hover:bg-slate-100 dark:hover:bg-slate-700",children:[t.jsxs("div",{className:"flex-grow min-w-0",children:[t.jsxs("p",{className:"font-bold text-slate-800 dark:text-slate-100 truncate flex items-center gap-2",title:e.name,children:[t.jsx("span",{className:`text-xs font-bold py-0.5 px-2 rounded-full ${e.documentType==="summary"?"bg-amber-200 text-amber-800":e.documentType==="analysis"?"bg-indigo-200 text-indigo-800":"bg-slate-200 text-slate-600"}`,children:w(e)}),t.jsx("span",{children:e.name})]}),t.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:[e.sourceFileName&&`(المصدر: ${e.sourceFileName}) - `,"تم الحفظ في: ",new Date(e.createdAt).toLocaleDateString("ar-EG")]})]}),t.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[t.jsx("button",{onClick:()=>o(e),className:"bg-green-100 text-green-800 font-semibold py-1 px-3 rounded-md hover:bg-green-200 dark:bg-green-900/40 dark:text-green-200 dark:hover:bg-green-900/60",children:"فتح"}),t.jsx("button",{onClick:()=>P(e),className:"bg-sky-100 text-sky-800 font-semibold py-1 px-3 rounded-md hover:bg-sky-200 dark:bg-sky-900/40 dark:text-sky-200 dark:hover:bg-sky-900/60",children:"تصدير كـ Word"}),t.jsx("button",{onClick:()=>T(e.id),className:"bg-red-100 text-red-800 font-semibold py-1 px-3 rounded-md hover:bg-red-200 dark:bg-red-900/40 dark:text-red-200 dark:hover:bg-red-900/60",children:"حذف"})]})]},e.id))})}),t.jsx(R,{isOpen:C,title:"تأكيد الحذف",message:"هل أنت متأكد من أنك تريد حذف هذا المستند؟ لا يمكن التراجع عن هذا الإجراء.",onConfirm:L,onCancel:M,confirmText:"نعم، احذف",cancelText:"إلغاء",confirmButtonClass:"bg-red-600 hover:bg-red-700"})]})};export{A as default};
