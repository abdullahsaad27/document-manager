import{r as l,j as e,a as z}from"./index-UgHTj-EG.js";import{a as M,g as C,s as q,d as B,b as Y}from"./settingsService-p0j8CqeW.js";import{g as H}from"./aiService-BjPKE4-L.js";import{r as J}from"./notificationService-43TODkn5.js";import"https://cdn.jsdelivr.net/npm/pdfjs-dist@4.4.168/build/pdf.min.mjs";const Q=[{id:"gemini-3-flash",name:"Gemini 3.0 Flash (الأحدث - سرعة فائقة)"},{id:"gemini-3-pro",name:"Gemini 3.0 Pro (الأقوى - دقة متناهية)"},{id:"gemini-2.5-flash",name:"Gemini 2.5 Flash (مستقر وسريع)"},{id:"gemini-2.5-flash-lite",name:"Gemini 2.5 Flash Lite (اقتصادي)"}],U=[{id:"mistral-ocr-latest",name:"Mistral OCR (متخصص للمستندات - الأفضل للـ PDF)"},{id:"mistral-large-latest",name:"Mistral Large (الأذكى للمحادثة)"},{id:"mistral-medium-latest",name:"Mistral Medium"},{id:"mistral-small-latest",name:"Mistral Small (السرعة)"},{id:"pixtral-12b-latest",name:"Pixtral 12B (للرؤية والتحليل)"}],ee=({onSave:T})=>{const[a,r]=l.useState(M()),[h,u]=l.useState(C()),[d,b]=l.useState([]),[n,p]=l.useState(""),[P,g]=l.useState(!1),[f,i]=l.useState(""),[j,k]=l.useState(""),[c,v]=l.useState(""),[m,N]=l.useState(""),[w,A]=l.useState("summary"),[y,F]=l.useState("Notification"in window?Notification.permission:"denied");l.useEffect(()=>{const t=M();r(t),u(C())},[]);const L=t=>{const s=t.target.value;let o="";s==="mistral"&&(o="mistral-ocr-latest"),s==="google"&&(o="gemini-3-flash"),s==="openai"&&(o="gpt-4o"),r(_=>({..._,provider:s,model:o})),b([]),p(""),i("")},x=t=>{r(s=>({...s,model:t.target.value}))},S=l.useCallback(async()=>{g(!0),i("");try{const t=await H();b(t),t.length>0&&!t.some(s=>s.id===a.model)&&r(s=>({...s,model:t.find(o=>o.id==="google/gemini-3-flash-preview")?.id||t[0].id}))}catch{i("فشل في جلب قائمة النماذج. تأكد من تكوين مفتاح OpenRouter على الخادم."),b([])}g(!1)},[a.model]);l.useEffect(()=>{a.provider==="openrouter"&&d.length===0&&S()},[a.provider,d.length,S]);const O=async()=>{i("");const t={...a};Y(t),k("تم حفظ الإعدادات بنجاح!"),setTimeout(()=>k(""),3e3),T()},I=async()=>{const t=await J();F(t)},E=()=>{if(!c.trim()||!m.trim())return;const t={id:Date.now().toString(),name:c,type:w,prompt:m},s=q(t);u(s),v(""),N("")},R=t=>{const s=B(t);u(s)},K=l.useMemo(()=>n?d.filter(t=>t.name.toLowerCase().includes(n.toLowerCase())):d,[d,n]),G=()=>{switch(a.provider){case"google":return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"googleApiKey",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"مفتاح API الخاص بك"}),e.jsx("input",{type:"password",id:"googleApiKey",value:a.googleApiKey||"",onChange:t=>r(s=>({...s,googleApiKey:t.target.value})),placeholder:"GOOGLE_API_KEY",className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-slate-800"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"يتم حفظ المفتاح محلياً في متصفحك. لن تحتاج لإدخاله مرة أخرى ما لم تقم بمسح بيانات التصفح."})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{htmlFor:"googleModel",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"النموذج"}),e.jsx("select",{id:"googleModel",value:a.model||"gemini-3-flash",onChange:x,className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-slate-800",children:Q.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]})]});case"mistral":return e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"يمكنك استخدام مفتاحك الخاص أو الاعتماد على مفتاح النظام إن وجد."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mistralKey",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"مفتاح API الخاص بك"}),e.jsx("input",{type:"password",id:"mistralKey",value:a.mistralApiKey||"",onChange:t=>r(s=>({...s,mistralApiKey:t.target.value})),placeholder:"MISTRAL_API_KEY",className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-slate-800"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mistralModel",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"النموذج"}),e.jsx("select",{id:"mistralModel",value:a.model||"mistral-ocr-latest",onChange:x,className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-slate-800",children:U.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]})]})]});case"openai":return e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"تم تكوين OpenAI API بشكل آمن على الخادم. حدد النموذج الذي ترغب في استخدامه."}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{htmlFor:"openaiModel",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"النموذج"}),e.jsx("input",{type:"text",id:"openaiModel",value:a.model,onChange:x,placeholder:"e.g., gpt-4o",className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-slate-800"})]})]});case"openrouter":return e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"تم تكوين OpenRouter API بشكل آمن على الخادم. اختر من قائمة النماذج المتاحة."}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{htmlFor:"openrouterModel",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"النموذج"}),P&&d.length===0?e.jsx(z,{}):d.length>0?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"search",placeholder:"ابحث عن نموذج...",value:n,onChange:t=>p(t.target.value),className:"w-full p-2 mb-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-800"}),e.jsx("select",{id:"openrouterModel",value:a.model,onChange:x,className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-slate-800",children:K.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}):e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"لا توجد نماذج متاحة. يرجى التحقق من تكوين الخادم."})]})]});default:return null}},D=()=>{switch(y){case"granted":return e.jsx("span",{className:"text-green-600 dark:text-green-400 font-semibold",children:"مفعّلة"});case"denied":return e.jsx("span",{className:"text-red-500 dark:text-red-400 font-semibold",children:"محظورة"});default:return e.jsx("span",{className:"text-slate-500 dark:text-slate-400 font-semibold",children:"غير محدد"})}};return e.jsxs("div",{className:"max-w-4xl mx-auto bg-white dark:bg-slate-800 p-8 rounded-xl shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-slate-800 dark:text-slate-100",children:"الإعدادات"}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100 mb-4 pb-2 border-b dark:border-slate-700",children:"الذكاء الاصطناعي"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"ai-provider",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"مزود الخدمة"}),e.jsxs("select",{id:"ai-provider",value:a.provider,onChange:L,className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-slate-800",children:[e.jsx("option",{value:"google",children:"Google (الافتراضي)"}),e.jsx("option",{value:"mistral",children:"Mistral AI (مستضاف)"}),e.jsx("option",{value:"openai",children:"OpenAI (مستضاف)"}),e.jsx("option",{value:"openrouter",children:"OpenRouter (مستضاف)"})]})]}),e.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 border dark:border-slate-700 rounded-lg",children:G()})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100 mb-4 pb-2 border-b dark:border-slate-700",children:"إعدادات معالجة PDF"}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 border dark:border-slate-700 rounded-lg",children:[e.jsx("label",{htmlFor:"chunkSize",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"عدد الصفحات في كل دفعة معالجة"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{id:"chunkSize",value:a.pdfChunkSize||5,onChange:t=>r(s=>({...s,pdfChunkSize:Number(t.target.value)})),className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-slate-800 appearance-none",children:[1,2,3,4,5,10,15,20,25,50].map(t=>e.jsxs("option",{value:t,children:[t," صفحات في كل طلب"]},t))}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center px-2 text-slate-700 dark:text-slate-300",children:e.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-2",children:"يحدد عدد الصفحات التي يتم إرسالها للذكاء الاصطناعي في المرة الواحدة. القيم الأقل تزيد الدقة وتقلل احتمالية الأخطاء، بينما القيم الأكبر تزيد السرعة."})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100 mb-4 pb-2 border-b dark:border-slate-700",children:"إدارة القوالب"}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 border dark:border-slate-700 rounded-lg mb-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm text-slate-700 dark:text-slate-300",children:"إضافة قالب جديد"}),e.jsxs("div",{className:"grid gap-3 mb-3",children:[e.jsx("input",{type:"text",placeholder:"اسم القالب (مثلاً: تلخيص قانوني)",value:c,onChange:t=>v(t.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-800"}),e.jsxs("select",{value:w,onChange:t=>A(t.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-800",children:[e.jsx("option",{value:"summary",children:"تلخيص"}),e.jsx("option",{value:"correction",children:"تصحيح"})]}),e.jsx("textarea",{placeholder:"اكتب التعليمات الخاصة بالقالب هنا...",value:m,onChange:t=>N(t.target.value),rows:3,className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-800"})]}),e.jsx("button",{onClick:E,disabled:!c||!m,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:"إضافة القالب"})]}),e.jsx("div",{className:"space-y-2",children:h.length===0?e.jsx("p",{className:"text-sm text-slate-500",children:"لا توجد قوالب محفوظة."}):h.map(t=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white dark:bg-slate-700 border dark:border-slate-600 rounded-md shadow-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm text-slate-800 dark:text-slate-200",children:t.name}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:t.type==="summary"?"تلخيص":"تصحيح"})]}),e.jsx("button",{onClick:()=>R(t.id),className:"text-red-500 hover:text-red-700 text-sm",children:"حذف"})]},t.id))})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100 mb-4 pb-2 border-b dark:border-slate-700",children:"المظهر والإشعارات"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"theme",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"المظهر"}),e.jsxs("select",{id:"theme",value:a.theme,onChange:t=>r(s=>({...s,theme:t.target.value})),className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-slate-800",children:[e.jsx("option",{value:"light",children:"فاتح"}),e.jsx("option",{value:"dark",children:"داكن"}),e.jsx("option",{value:"system",children:"النظام"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/50 border dark:border-slate-700 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"إشعارات المتصفح"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"لإعلامك عند اكتمال المهام في الخلفية"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm",children:D()}),y==="default"&&e.jsx("button",{onClick:I,className:"px-3 py-1 bg-blue-600 text-white text-xs font-semibold rounded hover:bg-blue-700",children:"تفعيل"})]})]})]})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t dark:border-slate-700 flex justify-end items-center gap-4",children:[f&&e.jsx("p",{className:"text-red-500 text-sm flex-grow",children:f}),j&&e.jsx("p",{className:"text-green-600 text-sm flex-grow",children:j}),e.jsx("button",{id:"primary-action-button",onClick:O,className:"bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition-colors",children:"حفظ الإعدادات"})]})]})};export{ee as default};
