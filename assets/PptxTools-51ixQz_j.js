import{r,j as e,a as $,P as J,R as W}from"./index-UgHTj-EG.js";import{F as O}from"./FileUpload-l6TYIoDx.js";import{h as X,a as q}from"./aiService-BjPKE4-L.js";import{R as M}from"./ResultView-BglrxiX5.js";import{S as K}from"./ServiceCard-C1-ocAQN.js";import{a as Y,G as Z,T as C}from"./settingsService-p0j8CqeW.js";import{e as H}from"./textExtractorService-Dks41_ry.js";import"https://cdn.jsdelivr.net/npm/pdfjs-dist@4.4.168/build/pdf.min.mjs";import"./database-CGTBBJr-.js";var V={};const Q=()=>{const[p,j]=r.useState("topic"),[u,d]=r.useState(""),[g,o]=r.useState(null),[E,b]=r.useState(5),[i,T]=r.useState(!1),[x,f]=r.useState(""),[F,R]=r.useState(""),[A,L]=r.useState(null),v=a=>{a.length>0&&o(a[0])},U=async a=>{const h=Y(),S=h.googleApiKey||V.API_KEY;if(!S)throw new Error("API Key missing");const P=new Z({apiKey:S}),t=h.model||"gemini-3-flash-preview",s=`Create a PowerPoint presentation outline about the following context. 
        Create exactly ${E} slides.
        For each slide, provide a 'title', an array of 'bullets' (3-5 points), and 'notes' for the speaker.
        The content must be in Arabic.
        
        Context:
        ${a.substring(0,3e4)}
        `,l={type:C.ARRAY,items:{type:C.OBJECT,properties:{title:{type:C.STRING},bullets:{type:C.ARRAY,items:{type:C.STRING}},notes:{type:C.STRING}},required:["title","bullets"]}},c=await P.models.generateContent({model:t,contents:s,config:{responseMimeType:"application/json",responseSchema:l}});return JSON.parse(c.text||"[]")},D=async a=>{if(!window.PptxGenJS)throw new Error("PptxGenJS library not loaded");const h=new window.PptxGenJS;h.layout="LAYOUT_16x9",h.rtlMode=!0,a.forEach(P=>{const t=h.addSlide();t.addText(P.title,{x:.5,y:.5,w:"90%",h:1,fontSize:24,bold:!0,color:"363636",align:"right",isTextBox:!0,dir:"rtl"}),t.addText(P.bullets.map(s=>({text:s,options:{dir:"rtl",align:"right"}})),{x:.5,y:1.8,w:"90%",h:"60%",fontSize:18,color:"555555",align:"right",bullet:!0,isTextBox:!0}),P.notes&&t.addNotes(P.notes)});const S=await h.write("blob");return new File([S],`presentation-${Date.now()}.pptx`,{type:"application/vnd.openxmlformats-officedocument.presentationml.presentation"})},B=async()=>{T(!0),R(""),f("جاري تحضير المحتوى...");try{let a="";if(p==="topic"){if(!u.trim())throw new Error("الرجاء إدخال موضوع.");a=u}else{if(!g)throw new Error("الرجاء اختيار ملف.");if(f("جاري قراءة الملف..."),a=await H(g,()=>{}),!a.trim())throw new Error("الملف فارغ.")}f("جاري توليد هيكل الشرائح بالذكاء الاصطناعي...");const h=await U(a);f("جاري إنشاء ملف PowerPoint...");const S=await D(h);L(S),f("تم الانتهاء!")}catch(a){R(a.message||"حدث خطأ أثناء التوليد.")}finally{T(!1)}};return A?e.jsx(M,{title:"تم إنشاء العرض التقديمي!",file:A,onReset:()=>{L(null),f("")}}):e.jsxs("div",{className:"max-w-3xl mx-auto bg-white dark:bg-slate-800 p-8 rounded-xl shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100 mb-6 text-center",children:"إنشاء عرض PowerPoint"}),e.jsxs("div",{className:"flex justify-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>j("topic"),className:`px-4 py-2 rounded-lg ${p==="topic"?"bg-blue-600 text-white":"bg-slate-200 text-slate-800"}`,children:"موضوع"}),e.jsx("button",{onClick:()=>j("file"),className:`px-4 py-2 rounded-lg ${p==="file"?"bg-blue-600 text-white":"bg-slate-200 text-slate-800"}`,children:"من ملف"})]}),e.jsx("div",{className:"mb-6",children:p==="topic"?e.jsx("textarea",{value:u,onChange:a=>d(a.target.value),placeholder:"اكتب موضوع العرض التقديمي هنا...",className:"w-full p-4 border rounded-lg bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600",rows:4}):e.jsx(O,{onFileSelect:v,acceptedFileTypes:".pdf,.docx,.txt",promptText:g?g.name:"اختر ملفاً لتحويله إلى عرض تقديمي"})}),e.jsxs("div",{className:"mb-6 flex items-center gap-4",children:[e.jsx("label",{className:"font-semibold",children:"عدد الشرائح:"}),e.jsx("input",{type:"number",min:"1",max:"20",value:E,onChange:a=>b(parseInt(a.target.value)),className:"p-2 border rounded w-20 text-center dark:bg-slate-700"})]}),e.jsx("button",{onClick:B,disabled:i,className:"w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 disabled:bg-slate-400",children:i?e.jsx($,{}):"إنشاء العرض التقديمي"}),x&&e.jsx("p",{className:"mt-4 text-center text-slate-600 dark:text-slate-300",children:x}),F&&e.jsx("p",{className:"mt-4 text-center text-red-500",children:F})]})},ee=()=>{const[p,j]=r.useState(null),[u,d]=r.useState(!1),[g,o]=r.useState(""),[E,b]=r.useState(""),[i,T]=r.useState(null),[x,f]=r.useState("summary"),[F,R]=r.useState({}),[A,L]=r.useState(!0),v=W.useRef(null),U=t=>{const s=t[0];s&&(["application/vnd.openxmlformats-officedocument.presentationml.presentation"].includes(s.type)?(j(s),b(""),T(null),D(s)):b("الرجاء اختيار ملف PowerPoint (PPTX) فقط."))},D=async t=>{d(!0),b(""),o("جاري قراءة ملف PPTX...");try{const s=await JSZip.loadAsync(t);o("جاري استخراج النصوص للتلخيص...");let l="";const c=s.filter(n=>n.startsWith("ppt/slides/slide")&&n.endsWith(".xml"));for(const n of c){const k=await n.async("string");new DOMParser().parseFromString(k,"application/xml").querySelectorAll("a\\:t").forEach(_=>{l+=_.textContent+" "})}const w=l.trim()?await q(l,"points",o):"لم يتم العثور على نص في العرض التقديمي.";o("جاري استخراج الصور...");const y=s.filter(n=>n.startsWith("ppt/media/")),m=[],N={};for(const n of y){const k=await n.async("blob"),G=URL.createObjectURL(k);m.push({name:n.name,dataUrl:G,description:""}),N[n.name]={description:"",isLoading:!0}}R(N),o("جاري عرض الشرائح للتصدير...");const I=window.pptx;if(v.current)if(I&&typeof I.render=="function"){L(!0);try{await I.render(t,v.current,null,{slideRatio:"16:9",responsive:!0}),await new Promise(n=>setTimeout(n,2e3))}catch(n){console.warn("PPTX Render Error:",n),L(!1)}}else console.warn("PPTX preview library is not loaded or invalid."),L(!1);T({summary:w,images:m,slides:[]}),d(!1),o("")}catch(s){b("فشل في معالجة ملف PPTX. قد يكون الملف تالفًا أو بصيغة غير مدعومة."),console.error(s),d(!1)}};r.useEffect(()=>{i?.images&&i.images.length>0&&i.images.forEach(t=>{F[t.name]?.isLoading&&B(t)})},[i]);const B=async t=>{try{const l=await(await fetch(t.dataUrl)).blob(),c=new FileReader;c.readAsDataURL(l),c.onloadend=async()=>{const y={inlineData:{data:c.result.split(",")[1],mimeType:l.type}},m=await X(y);R(N=>({...N,[t.name]:{description:m,isLoading:!1}}))}}catch(s){console.error("Failed to describe image",s),R(l=>({...l,[t.name]:{description:"فشل في إنشاء الوصف",isLoading:!1}}))}},a=async()=>{if(v.current){d(!0),o("جاري تصدير الشرائح...");try{const t=new JSZip,s=v.current.querySelectorAll(".slide");for(let w=0;w<s.length;w++){o(`جاري معالجة الشريحة ${w+1} من ${s.length}...`);const y=await html2canvas(s[w],{scale:2}),m=await new Promise(N=>y.toBlob(N,"image/png"));m&&t.file(`slide-${w+1}.png`,m)}const l=await t.generateAsync({type:"blob"}),c=document.createElement("a");c.href=URL.createObjectURL(l),c.download=`${p?.name.replace(/\.pptx$/i,"")}-slides.zip`,c.click(),URL.revokeObjectURL(c.href)}catch{b("حدث خطأ أثناء تصدير الشرائح.")}finally{d(!1),o("")}}},h=async()=>{if(!(!v.current||!p)){d(!0),o("جاري تحويل الشرائح إلى PDF..."),b("");try{const{PDFDocument:t}=PDFLib,s=await t.create(),l=v.current.querySelectorAll(".slide");for(let m=0;m<l.length;m++){o(`جاري معالجة الشريحة ${m+1} من ${l.length}...`);const I=(await html2canvas(l[m],{scale:2})).toDataURL("image/png"),n=await fetch(I).then(z=>z.arrayBuffer()),k=await s.embedPng(n);s.addPage([k.width,k.height]).drawImage(k,{x:0,y:0,width:k.width,height:k.height})}const c=await s.save(),w=new Blob([c],{type:"application/pdf"}),y=document.createElement("a");y.href=URL.createObjectURL(w),y.download=`${p.name.replace(/\.pptx$/i,"")}.pdf`,y.click(),URL.revokeObjectURL(y.href)}catch(t){b("حدث خطأ أثناء إنشاء ملف PDF."),console.error(t)}finally{d(!1),o("")}}},S=()=>{j(null),T(null),b(""),o(""),d(!1)},P=i?[{type:"paragraph",content:i.summary}]:[];return e.jsxs("div",{className:"max-w-5xl mx-auto",children:[!i&&e.jsx("div",{className:"bg-white dark:bg-slate-800 p-8 rounded-xl shadow-lg max-w-3xl mx-auto",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(O,{onFileSelect:U,acceptedFileTypes:".pptx,application/vnd.openxmlformats-officedocument.presentationml.presentation",promptText:"اسحب وأفلت ملف PowerPoint (PPTX) هنا أو انقر للاختيار"}),u&&e.jsxs("div",{className:"mt-4 flex flex-col items-center gap-2",children:[e.jsx($,{}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:g})]})]})}),i&&e.jsxs(M,{title:`نتائج تحليل: ${p?.name}`,onReset:S,canSaveToLibrary:!0,structuredContent:P,fileName:`ملخص - ${p?.name}`,fileType:"text/plain",children:[e.jsxs("div",{role:"tablist",className:"flex items-center gap-2 p-1 bg-slate-100 dark:bg-slate-700 rounded-lg mb-6 max-w-md mx-auto",children:[e.jsx("button",{role:"tab","aria-selected":x==="summary",onClick:()=>f("summary"),className:`flex-1 px-4 py-1.5 rounded-md text-sm font-semibold transition-colors ${x==="summary"?"bg-white dark:bg-slate-600 shadow text-blue-600 dark:text-white":"text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:"الملخص"}),e.jsx("button",{role:"tab","aria-selected":x==="images",onClick:()=>f("images"),className:`flex-1 px-4 py-1.5 rounded-md text-sm font-semibold transition-colors ${x==="images"?"bg-white dark:bg-slate-600 shadow text-blue-600 dark:text-white":"text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:"الصور"}),e.jsx("button",{role:"tab","aria-selected":x==="slides",onClick:()=>f("slides"),disabled:!A,className:`flex-1 px-4 py-1.5 rounded-md text-sm font-semibold transition-colors ${x==="slides"?"bg-white dark:bg-slate-600 shadow text-blue-600 dark:text-white":"text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed"}`,children:"الشرائح"})]}),e.jsxs("div",{className:"text-right",children:[x==="summary"&&e.jsx("div",{role:"tabpanel",className:"prose prose-slate dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:i.summary.replace(/\n/g,"<br />")}}),x==="images"&&e.jsx("div",{role:"tabpanel",children:i.images.length===0?e.jsx("p",{children:"لم يتم العثور على صور في هذا الملف."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.images.map(t=>e.jsxs("div",{className:"border dark:border-slate-700 rounded-lg p-2 flex flex-col items-center",children:[e.jsx("img",{src:t.dataUrl,alt:t.name,className:"max-w-full h-auto rounded-md mb-2"}),e.jsx("div",{className:"w-full text-center p-2 bg-slate-50 dark:bg-slate-700 rounded-b-lg min-h-[60px]",children:F[t.name]?.isLoading?e.jsx($,{}):e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300",children:F[t.name]?.description})})]},t.name))})}),x==="slides"&&e.jsx("div",{role:"tabpanel",className:"text-center",children:A?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mb-4 text-slate-600 dark:text-slate-300",children:"يمكنك تصدير جميع الشرائح كصور عالية الجودة (في ملف ZIP) أو كمستند PDF واحد."}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-4",children:[e.jsxs("button",{onClick:a,disabled:u,className:"bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition-colors disabled:bg-slate-400 flex items-center gap-2 mx-auto",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),e.jsx("span",{children:"تنزيل كصور (ZIP)"})]}),e.jsxs("button",{onClick:h,disabled:u,className:"bg-sky-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-sky-700 transition-colors disabled:bg-slate-400 flex items-center gap-2 mx-auto",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"})]}),e.jsx("span",{children:"تنزيل كـ PDF"})]})]}),u&&e.jsxs("div",{className:"mt-4 flex flex-col items-center gap-2",children:[e.jsx($,{}),e.jsx("p",{children:g})]})]}):e.jsx("div",{className:"p-4 bg-amber-100 dark:bg-amber-900/30 border border-amber-300 dark:border-amber-700 rounded-lg text-amber-800 dark:text-amber-200",children:"معاينة الشرائح وتصديرها غير متوفرة حالياً لأن المكتبة اللازمة لم يتم تحميلها بشكل صحيح."})})]})]}),E&&e.jsx("p",{role:"alert",className:"mt-4 text-red-500 bg-red-100 dark:bg-red-900/50 dark:text-red-300 p-3 rounded-md w-full text-center",children:E}),e.jsx("div",{ref:v,className:"hidden"})]})},de=({onSelectService:p})=>{const[j,u]=r.useState(null),d=()=>{u(null)};return j?e.jsxs("div",{children:[e.jsxs("button",{onClick:d,className:"mb-6 flex items-center gap-2 text-blue-600 hover:text-blue-800 transition-colors font-semibold",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"transform scale-x-[-1]","aria-hidden":"true",children:[e.jsx("path",{d:"M5 12h14"}),e.jsx("path",{d:"m12 5 7 7-7 7"})]}),e.jsx("span",{children:"العودة إلى أدوات PowerPoint"})]}),j.id==="analyze-pptx"&&e.jsx(ee,{}),j.id==="generate-pptx"&&e.jsx(Q,{})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-slate-800 dark:text-slate-100 mb-4",children:"أدوات PowerPoint"}),e.jsx("p",{className:"text-lg text-slate-600 dark:text-slate-300 max-w-3xl mx-auto",children:"حلول ذكية للتعامل مع العروض التقديمية: تلخيص، استخراج محتوى، وإنشاء عروض جديدة."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto",children:J.map(g=>e.jsx(K,{service:g,onClick:u},g.id))})]})};export{de as default};
