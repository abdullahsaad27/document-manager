import{r as s,j as e,a as p}from"./index-C3edZBvR.js";import{o as y}from"./aiService-BE1pcnuv.js";import{F as k}from"./FileUpload-VNhAmH-W.js";import{R as N}from"./ResultView-_dusQHX8.js";import"https://cdn.jsdelivr.net/npm/pdfjs-dist@4.4.168/build/pdf.min.mjs";import"./settingsService-p0j8CqeW.js";import"./database-CGTBBJr-.js";const U=({onSelectService:S})=>{const[a,i]=s.useState(null),[d,m]=s.useState(!1),[o,n]=s.useState(""),[u,r]=s.useState(""),[h,c]=s.useState(""),b=t=>{if(t.length>0){const l=t[0];if(!l.type.startsWith("image/")){r("الرجاء اختيار ملف صورة (PNG, JPG, WEBP).");return}i(l),n(""),r(""),c(URL.createObjectURL(l))}},f=async t=>({inlineData:{data:await new Promise(v=>{const x=new FileReader;x.onloadend=()=>v(x.result.split(",")[1]),x.readAsDataURL(t)}),mimeType:t.type}}),g=async()=>{if(!a){r("الرجاء اختيار ملف صورة أولاً.");return}m(!0),r(""),n("");try{const t=await f(a),l=await y(t);n(l)}catch(t){r(t.message||"حدث خطأ غير متوقع أثناء استخراج النص."),i(null),c("")}finally{m(!1)}},w=()=>{i(null),n(""),r(""),c("")},j=()=>{navigator.clipboard.writeText(o).then(()=>{alert("تم نسخ النص!")}).catch(t=>{console.error("فشل النسخ: ",t)})};if(o&&a){const t=[{type:"paragraph",content:o}];return e.jsx(N,{title:`النص المستخرج من: ${a.name}`,onReset:w,canSaveToLibrary:!0,structuredContent:t,fileName:a.name,fileType:a.type,children:e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{readOnly:!0,value:o,className:"w-full h-96 p-4 border rounded-lg bg-slate-50 text-right font-sans dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200",placeholder:"النص المستخرج...",style:{direction:"rtl"},"aria-label":"النص المستخرج"}),e.jsx("button",{onClick:j,className:"absolute top-2 left-2 p-2 bg-slate-200 dark:bg-slate-600 rounded-md hover:bg-slate-300 dark:hover:bg-slate-500","aria-label":"نسخ النص",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})})]})})}return e.jsx("div",{className:"max-w-4xl mx-auto bg-white dark:bg-slate-800 p-8 rounded-xl shadow-lg",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"w-full md:w-1/2 flex flex-col items-center",children:d?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-10",children:[e.jsx(p,{}),e.jsx("p",{className:"mt-2 text-slate-600 dark:text-slate-300",children:"جاري الاستخراج..."})]}):h?e.jsx("div",{className:"w-full h-full flex-grow cursor-pointer bg-slate-100 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-6 text-center hover:bg-slate-200 dark:hover:bg-slate-700 flex flex-col items-center justify-center",children:e.jsx("img",{src:h,alt:"Preview",className:"max-h-80 w-auto rounded-md object-contain"})}):e.jsx(k,{onFileSelect:b,acceptedFileTypes:"image/png,image/jpeg,image/webp",promptText:"اسحب صورة هنا أو انقر للاختيار",promptSubText:"يدعم: PNG, JPG, WEBP"})}),e.jsxs("div",{className:"w-full md:w-1/2 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold mb-4 text-slate-700 dark:text-slate-200",children:"الاستخراج بالنقر"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:"ارفع صورة تحتوي على نص (مثل مستند ممسوح ضوئيًا أو لقطة شاشة)، وسيقوم الذكاء الاصطناعي باستخراج النص لك."})]}),u&&e.jsx("p",{role:"alert",className:"text-red-500 bg-red-100 dark:bg-red-900/50 dark:text-red-300 p-3 rounded-md w-full text-center",children:u}),e.jsx("button",{id:"primary-action-button",title:"Cmd/Ctrl + Enter",onClick:g,disabled:d||!a,className:"w-full bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-slate-400 disabled:cursor-not-allowed flex items-center justify-center",children:d?e.jsx(p,{}):"استخراج النص الآن"})]})]})})};export{U as default};
