import{r as a,u as Z,j as e,a as ee}from"./index-UgHTj-EG.js";import{d as te,A as U,e as se}from"./aiService-BjPKE4-L.js";import{F as re}from"./FileUpload-l6TYIoDx.js";import{e as le}from"./textExtractorService-Dks41_ry.js";import{n as G}from"./notificationService-43TODkn5.js";import"https://cdn.jsdelivr.net/npm/pdfjs-dist@4.4.168/build/pdf.min.mjs";import"./settingsService-p0j8CqeW.js";const me=()=>{const[f,c]=a.useState("config"),[o,k]=a.useState("chat"),[b,j]=a.useState(null),[h,N]=a.useState(""),[O,y]=a.useState(""),[x,C]=a.useState("5"),[S,q]=a.useState(""),[F,T]=a.useState("hybrid"),[$,z]=a.useState(""),[v,A]=a.useState([]),[i,E]=a.useState({}),[w,Q]=a.useState(null),[I,g]=a.useState(null),[P,u]=a.useState(!1),[B,m]=a.useState(""),[R,n]=a.useState(""),D=a.useRef([]),{setInterruptedTask:L}=Z(),V=()=>{c("config"),k("chat"),j(null),N(""),y(""),C("5"),q(""),T("hybrid"),z(""),A([]),E({}),Q(null),u(!1),m(""),n(""),g(null)},_=async t=>{const s=t?.[0];if(s){if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"].includes(s.type)){n("نوع الملف غير مدعوم. الرجاء اختيار PDF, DOCX, أو TXT.");return}j(s),u(!0),n("");try{const r=await le(s,m);if(!r.trim())throw new Error("الملف فارغ أو لا يحتوي على نص قابل للاستخراج.");y(r)}catch(r){n(r.message),j(null)}finally{u(!1),m("")}}},M=async(t,s,l,r)=>{u(!0),m("يقوم الذكاء الاصطناعي بإنشاء الاختبار..."),c("generating");try{if(isNaN(s)||s<1)throw new Error("الرجاء إدخال عدد صالح من الأسئلة.");const d=await te(t,s,l,r);if(d.quiz&&d.quiz.length>0)A(d.quiz),D.current=Array(d.quiz.length).fill(null),c("taking"),G("✅ اختبارك جاهز!",{body:`تم إنشاء اختبار من ${b?`"${b.name}"`:`موضوع "${h}"`}.`});else throw new Error("لم يتمكن الذكاء الاصطناعي من إنشاء اختبار. حاول مرة أخرى.")}catch(d){d instanceof U?L({serviceId:"quiz",resume:()=>M(t,s,l,r),context:{}}):(n(d.message),c("config"),G("❌ فشل إنشاء الاختبار",{body:"حدث خطأ أثناء إنشاء الاختبار."}))}finally{u(!1),m("")}},H=async()=>{n("");const t=o==="file"?O:h;if(!t.trim()){n(o==="file"?"الرجاء رفع ملف صالح أولاً.":"الرجاء إدخال موضوع للمحادثة.");return}const s=parseInt(x==="more"?S:x,10);M(t,s,F,$)},X=async(t,s)=>{u(!0),m("يقوم الذكاء الاصطناعي بتصحيح إجاباتك..."),c("scoring"),n("");try{const l=await se(t,s);Q(l),c("results")}catch(l){l instanceof U?(L({serviceId:"quiz",resume:()=>X(t,s),context:{}}),c("taking")):(n(l.message),c("taking"))}finally{u(!1),m("")}},p=(t,s)=>{I===t&&g(null),E(l=>({...l,[t]:s}))},J=async()=>{g(null);for(let t=0;t<v.length;t++)if(!i[t]||i[t].toString().trim()===""){g(t),document.getElementById(`question-container-${t}`)?.scrollIntoView({behavior:"smooth",block:"center"});return}X(v,i)},K=(t,s)=>{const l=`question-title-${s}`;return e.jsxs("div",{id:`question-container-${s}`,ref:r=>{r&&(D.current[s]=r)},"data-question-index":s,className:"scroll-mt-8",children:[e.jsx("h3",{id:l,className:"text-xl font-bold mb-4 text-slate-800 dark:text-slate-100",children:`السؤال ${s+1}: ${t.question}`}),t.type==="multiple-choice"&&e.jsxs("fieldset",{role:"radiogroup","aria-labelledby":l,children:[e.jsx("legend",{className:"sr-only",children:t.question}),e.jsx("div",{className:"space-y-3",children:t.options?.map((r,d)=>e.jsxs("label",{className:"block p-3 border-2 rounded-lg cursor-pointer transition-colors border-slate-300 dark:border-slate-600 hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-slate-700 has-[:checked]:bg-blue-100 dark:has-[:checked]:bg-blue-900/50 has-[:checked]:border-blue-600",children:[e.jsx("input",{type:"radio",name:`question-${s}`,value:r,className:"ml-3",onChange:Y=>p(s,Y.target.value),checked:i[s]===r}),r]},d))})]}),t.type==="true-false"&&e.jsxs("fieldset",{role:"radiogroup","aria-labelledby":l,children:[e.jsx("legend",{className:"sr-only",children:t.question}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex-1 p-3 border-2 rounded-lg cursor-pointer transition-colors text-center font-bold border-slate-300 dark:border-slate-600 hover:border-green-500 hover:bg-green-50 dark:hover:bg-slate-700 has-[:checked]:bg-green-100 dark:has-[:checked]:bg-green-900/50 has-[:checked]:border-green-600",children:[e.jsx("input",{type:"radio",name:`question-${s}`,value:"صواب",className:"sr-only",onChange:r=>p(s,r.target.value),checked:i[s]==="صواب"}),"صواب"]}),e.jsxs("label",{className:"flex-1 p-3 border-2 rounded-lg cursor-pointer transition-colors text-center font-bold border-slate-300 dark:border-slate-600 hover:border-red-500 hover:bg-red-50 dark:hover:bg-slate-700 has-[:checked]:bg-red-100 dark:has-[:checked]:bg-red-900/50 has-[:checked]:border-red-600",children:[e.jsx("input",{type:"radio",name:`question-${s}`,value:"خطأ",className:"sr-only",onChange:r=>p(s,r.target.value),checked:i[s]==="خطأ"}),"خطأ"]})]})]}),t.type==="open-ended"&&e.jsx("div",{children:e.jsx("textarea",{id:`answer-${s}`,rows:3,value:i[s]||"",onChange:r=>p(s,r.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-slate-800",placeholder:"اكتب إجابتك هنا...","aria-labelledby":l})}),I===s&&e.jsx("p",{role:"alert",className:"text-red-500 text-sm mt-2 font-semibold",children:"الرجاء الإجابة على هذا السؤال للمتابعة."})]})},W=(t,s)=>{const l=t.isCorrect?"bg-green-50 dark:bg-green-900/30 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/30 border-red-200 dark:border-red-800";return e.jsxs("div",{className:`p-4 border-b ${l}`,children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2",children:[s+1,". ",t.question]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-bold",children:"إجابتك: "}),e.jsxs("span",{className:t.isCorrect?"text-green-800 dark:text-green-300":"text-red-800 dark:text-red-300",children:[t.userAnswer||"لم تتم الإجابة"," ",t.isCorrect?"✅":"❌",e.jsx("span",{className:"sr-only",children:t.isCorrect?"(إجابة صحيحة)":"(إجابة خاطئة)"})]})]}),!t.isCorrect&&e.jsxs("p",{className:"text-sm mt-1",children:[e.jsx("span",{className:"font-bold",children:"الإجابة الصحيحة: "}),e.jsx("span",{className:"text-green-800 dark:text-green-300",children:t.correctAnswer})]})]},s)};return P?e.jsxs("div",{className:"max-w-3xl mx-auto bg-white dark:bg-slate-800 p-8 rounded-xl shadow-lg flex flex-col items-center justify-center h-96",children:[e.jsx(ee,{}),e.jsx("p",{className:"mt-4 text-slate-600 dark:text-slate-300 font-semibold","aria-live":"polite",children:B})]}):e.jsxs("div",{className:"max-w-4xl mx-auto bg-white dark:bg-slate-800 p-8 rounded-xl shadow-lg",children:[f==="config"&&e.jsxs("div",{className:"flex flex-col items-center max-w-3xl mx-auto",children:[e.jsxs("div",{role:"tablist",className:"flex items-center gap-2 p-1 bg-slate-100 dark:bg-slate-700 rounded-lg mb-6",children:[e.jsx("button",{role:"tab","aria-selected":o==="chat",onClick:()=>k("chat"),className:`px-4 py-1.5 rounded-md text-sm font-semibold transition-colors ${o==="chat"?"bg-white dark:bg-slate-600 shadow text-blue-600 dark:text-white":"text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:"محادثة مباشرة"}),e.jsx("button",{role:"tab","aria-selected":o==="file",onClick:()=>k("file"),className:`px-4 py-1.5 rounded-md text-sm font-semibold transition-colors ${o==="file"?"bg-white dark:bg-slate-600 shadow text-blue-600 dark:text-white":"text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:"رفع مستند"})]}),o==="chat"?e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"chat-topic",className:"block text-lg font-semibold text-slate-700 dark:text-slate-200 mb-2",children:"اكتب موضوعًا لإنشاء اختبار عنه:"}),e.jsx("textarea",{id:"chat-topic",rows:4,value:h,onChange:t=>N(t.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-slate-800",placeholder:"مثال: تاريخ استكشاف الفضاء، أساسيات الطهي الإيطالي..."})]}):e.jsxs("div",{className:"w-full",children:[e.jsx(re,{onFileSelect:_,acceptedFileTypes:".pdf,.docx,.txt",promptText:b?b.name:"اسحب وأفلت ملف (PDF, DOCX, TXT) هنا أو انقر للاختيار"}),b&&e.jsxs("div",{className:"mt-4 w-full",children:[e.jsx("label",{htmlFor:"custom-instructions",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"تعليمات مخصصة للذكاء الاصطناعي:"}),e.jsx("textarea",{id:"custom-instructions",rows:2,value:$,onChange:t=>z(t.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-slate-800",placeholder:"مثال: ركز على التواريخ والأحداث الرئيسية، اجعل الأسئلة للمبتدئين...","aria-describedby":"instructions-help"}),e.jsx("p",{id:"instructions-help",className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"اكتب التعليمات الخاصة بمصدر الأسئلة."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-6 w-full",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"num-questions",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"عدد الأسئلة:"}),e.jsxs("select",{id:"num-questions",value:x,onChange:t=>C(t.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-slate-800",children:[[...Array(28)].map((t,s)=>e.jsx("option",{value:s+3,children:s+3},s+3)),e.jsx("option",{value:"more",children:"أكثر..."})]}),x==="more"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"custom-num-questions",className:"sr-only",children:"أدخل عدد الأسئلة"}),e.jsx("input",{id:"custom-num-questions",type:"number",value:S,onChange:t=>q(t.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-slate-800",placeholder:"أدخل العدد"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"question-type",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"نوع الأسئلة:"}),e.jsxs("select",{id:"question-type",value:F,onChange:t=>T(t.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-slate-800",children:[e.jsx("option",{value:"hybrid",children:"نمط مختلط"}),e.jsx("option",{value:"multiple-choice",children:"اختيار من متعدد"}),e.jsx("option",{value:"true-false",children:"صح أو خطأ"}),e.jsx("option",{value:"open-ended",children:"إجابة مفتوحة"})]})]})]}),e.jsx("button",{id:"primary-action-button",title:"Cmd/Ctrl + Enter",onClick:H,className:"mt-8 w-full bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-slate-400",disabled:o==="file"&&!b||o==="chat"&&!h,children:"إنشاء الاختبار"})]}),f==="taking"&&e.jsxs("div",{className:"w-full text-right",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-slate-700 dark:text-slate-200 text-center",children:"الاختبار جاهز!"}),e.jsxs("div",{className:"space-y-8",children:[v.map((t,s)=>e.jsx("div",{className:"p-6 bg-slate-50 dark:bg-slate-800/50 border dark:border-slate-700 rounded-xl",children:K(t,s)},s)),e.jsx("button",{id:"primary-action-button",title:"Cmd/Ctrl + Enter",onClick:J,className:"w-full bg-green-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-700 transition-colors",children:"إرسال الإجابات"})]})]}),f==="results"&&w&&e.jsxs("div",{className:"w-full text-right",children:[e.jsx("div",{className:"text-center p-6 bg-blue-100 dark:bg-blue-900/50 rounded-lg mb-6","aria-live":"assertive",children:e.jsxs("h2",{className:"text-3xl font-bold text-blue-800 dark:text-blue-200",children:["نتيجتك النهائية: ",w.score," / 100"]})}),e.jsx("div",{className:"space-y-2",children:w.results.map(W)}),e.jsx("button",{onClick:V,className:"mt-8 w-full bg-slate-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-slate-700 transition-colors",children:"البدء من جديد"})]}),R&&e.jsx("p",{role:"alert",className:"mt-4 text-red-500 bg-red-100 dark:bg-red-900/50 dark:text-red-300 p-3 rounded-md w-full text-center",children:R})]})};export{me as default};
