import{r as m,u as L,j as e,a as v}from"./index-UgHTj-EG.js";import{f as E,A}from"./aiService-BjPKE4-L.js";import{F as I}from"./FileUpload-l6TYIoDx.js";import{e as D}from"./textExtractorService-Dks41_ry.js";import{n as k}from"./notificationService-43TODkn5.js";import{g as M}from"./settingsService-p0j8CqeW.js";import"https://cdn.jsdelivr.net/npm/pdfjs-dist@4.4.168/build/pdf.min.mjs";const P=(i,c)=>{const o=i.split(/([ \n]+)/),l=c.split(/([ \n]+)/),s=Array(o.length+1).fill(null).map(()=>Array(l.length+1).fill(0));for(let n=1;n<=o.length;n++)for(let d=1;d<=l.length;d++)o[n-1]===l[d-1]?s[n][d]=s[n-1][d-1]+1:s[n][d]=Math.max(s[n-1][d],s[n][d-1]);const x=[];let a=o.length,t=l.length;for(;a>0||t>0;)if(a>0&&t>0&&o[a-1]===l[t-1])x.unshift({value:o[a-1],type:"same"}),a--,t--;else if(t>0&&(a===0||s[a][t-1]>=s[a-1][t]))x.unshift({value:l[t-1],type:"added"}),t--;else if(a>0&&(t===0||s[a][t-1]<s[a-1][t]))x.unshift({value:o[a-1],type:"removed"}),a--;else break;return x},X=({original:i,corrected:c})=>{const o=m.useMemo(()=>P(i,c),[i,c]);return e.jsx("div",{className:"w-full h-full p-4 border border-slate-300 dark:border-slate-600 rounded-md bg-slate-50 dark:bg-slate-700/50 font-sans whitespace-pre-wrap break-words overflow-y-auto leading-relaxed text-lg",style:{direction:"rtl"},"aria-label":"عرض الفروقات بين النص الأصلي والمصحح",children:o.map((l,s)=>l.type==="same"?e.jsx("span",{children:l.value},s):l.type==="added"?e.jsx("span",{className:"bg-green-200 dark:bg-green-900/60 text-green-900 dark:text-green-100 rounded px-1 mx-0.5 font-bold",children:l.value},s):l.type==="removed"?e.jsx("span",{className:"bg-red-200 dark:bg-red-900/60 text-red-900 dark:text-red-100 line-through decoration-red-600 rounded px-1 mx-0.5 opacity-70 text-sm",children:l.value},s):null)})},$=()=>{const[i,c]=m.useState(""),[o,l]=m.useState(""),[s,x]=m.useState(!1),[a,t]=m.useState(""),[n,d]=m.useState(null),[f,y]=m.useState([]),[h,b]=m.useState(""),{setInterruptedTask:N}=L();m.useEffect(()=>{y(M().filter(r=>r.type==="correction"))},[]);const T=async r=>{if(r.length>0){const u=r[0];if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"].includes(u.type)){t("نوع الملف غير مدعوم. الرجاء اختيار PDF, DOCX, أو TXT.");return}d(u),c(""),l(""),t(""),x(!0);try{const p=await D(u,w=>{});if(!p.trim())throw new Error("لم يتمكن من استخراج النص من المستند، قد يكون ملفًا قائمًا على الصور أو فارغًا.");c(p)}catch(p){t(p.message),d(null)}finally{x(!1)}}},g=async r=>{if(!r.trim()){t("الرجاء إدخال نص لتصحيحه.");return}x(!0),t(""),l("");try{let u="";if(h){const p=f.find(w=>w.id===h);p&&(u=`TEMPLATE:${p.prompt}`)}const j=await E(r);l(j),k("✅ اكتمل تصحيح النص!",{body:"أصبح النص المصحح جاهزًا للمراجعة."})}catch(u){u instanceof A?N({serviceId:"correct-text",resume:()=>g(r),context:{text:r}}):(t(u.message||"حدث خطأ غير متوقع."),k("❌ فشل تصحيح النص",{body:"حدث خطأ أثناء معالجة النص."}))}finally{x(!1)}},C=()=>{g(i)},F=()=>{c(""),l(""),t(""),d(null),b("")},S=()=>{navigator.clipboard.writeText(o).then(()=>{alert("تم نسخ النص المصحح!")}).catch(r=>console.error("Failed to copy text: ",r))};return e.jsxs("div",{className:"max-w-6xl mx-auto bg-white dark:bg-slate-800 p-8 rounded-xl shadow-lg",children:[e.jsx("h2",{className:"text-3xl font-bold text-center mb-8 text-slate-800 dark:text-slate-100",children:"مصحح النصوص الذكي"}),e.jsx("div",{className:"mb-8",children:e.jsx(I,{onFileSelect:T,acceptedFileTypes:".pdf,.docx,.txt",promptText:n?`الملف المحدد: ${n.name}`:"رفع مستند (PDF, DOCX, TXT) لتصحيحه",promptSubText:"أو الصق النص مباشرة بالأسفل"})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"flex flex-col h-96",children:[e.jsx("label",{htmlFor:"input-text",className:"block text-lg font-semibold text-slate-700 dark:text-slate-200 mb-2",children:"النص الأصلي"}),e.jsx("textarea",{id:"input-text",value:i,onChange:r=>c(r.target.value),placeholder:"اكتب أو الصق النص هنا...",className:"flex-1 w-full p-4 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-slate-700 font-sans leading-relaxed text-lg",style:{direction:"rtl"},disabled:s})]}),e.jsxs("div",{className:"flex flex-col h-96",children:[e.jsx("label",{htmlFor:"corrected-text",className:"block text-lg font-semibold text-slate-700 dark:text-slate-200 mb-2",children:"النص المصحح"}),e.jsxs("div",{className:"relative flex-1 w-full border border-slate-300 dark:border-slate-600 rounded-md overflow-hidden",children:[s?e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm z-10",children:[e.jsx(v,{}),e.jsx("p",{className:"mt-4 text-slate-600 dark:text-slate-300 font-medium animate-pulse",children:"جاري تدقيق وتصحيح النص..."})]}):null,o?e.jsx(X,{original:i,corrected:o}):e.jsx("div",{className:"w-full h-full bg-slate-50 dark:bg-slate-700/30 flex items-center justify-center",children:e.jsx("p",{className:"text-slate-400 dark:text-slate-500 text-center px-4",children:s?"":'اضغط على "تصحيح النص" لرؤية النتائج هنا...'})})]})]})]}),e.jsxs("div",{className:"mt-8 flex flex-col items-center gap-4",children:[f.length>0&&e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("label",{className:"block text-sm font-medium mb-1 dark:text-slate-300",children:"أسلوب التصحيح (اختياري):"}),e.jsxs("select",{value:h,onChange:r=>b(r.target.value),className:"w-full p-2 border rounded bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600",children:[e.jsx("option",{value:"",children:"تصحيح قياسي (إملائي ونحوي)"}),f.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4 w-full",children:[e.jsx("button",{id:"primary-action-button",title:"Cmd/Ctrl + Enter",onClick:C,disabled:s||!i.trim(),className:"bg-blue-600 text-white font-bold py-3 px-10 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-slate-400 disabled:cursor-not-allowed shadow-md flex items-center gap-2",children:s?e.jsx(v,{}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"m12 19 7-7 3 3-7 7-3-3z"}),e.jsx("path",{d:"m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"}),e.jsx("path",{d:"m2 2 7.586 7.586"}),e.jsx("circle",{cx:"11",cy:"11",r:"2"})]}),"تصحيح النص"]})}),e.jsxs("button",{onClick:S,disabled:!o,className:"bg-green-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-700 transition-colors disabled:bg-slate-400 disabled:cursor-not-allowed shadow-md flex items-center gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),"نسخ النتيجة"]}),e.jsx("button",{onClick:F,className:"text-slate-500 hover:text-red-600 dark:hover:text-red-400 font-semibold py-3 px-6 transition-colors",children:"إعادة تعيين"})]})]}),a&&e.jsx("p",{role:"alert",className:"mt-6 text-red-600 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 p-4 rounded-lg text-center font-medium",children:a})]})};export{$ as default};
